<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinSniper - Advanced Memecoin Sniper Bot</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-900 text-white">
    <!-- Navigation -->
    <nav class="bg-gray-800 border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-rocket text-2xl text-green-400"></i>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <span class="text-xl font-bold text-green-400">CoinSniper</span>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                        <span class="text-sm text-gray-300">Live</span>
                    </div>
                    <button id="refreshBtn" class="bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Status Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-500 bg-opacity-20">
                        <i class="fas fa-chart-line text-green-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Total Profit</p>
                        <p class="text-2xl font-bold text-green-400" id="totalProfit">$0.00</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-500 bg-opacity-20">
                        <i class="fas fa-trophy text-blue-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Win Rate</p>
                        <p class="text-2xl font-bold text-blue-400" id="winRate">0%</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-purple-500 bg-opacity-20">
                        <i class="fas fa-fire text-purple-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Active Trades</p>
                        <p class="text-2xl font-bold text-purple-400" id="activeTrades">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-500 bg-opacity-20">
                        <i class="fas fa-clock text-yellow-400 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-400">Uptime</p>
                        <p class="text-2xl font-bold text-yellow-400" id="uptime">0h 0m</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-bold mb-4">Control Panel</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Status</label>
                    <div class="flex items-center space-x-4">
                        <button id="startBtn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-md font-medium">
                            <i class="fas fa-play mr-2"></i>Start
                        </button>
                        <button id="stopBtn" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md font-medium">
                            <i class="fas fa-stop mr-2"></i>Stop
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Scan Interval</label>
                    <select id="scanInterval" class="bg-gray-700 border border-gray-600 rounded-md px-3 py-2 w-full">
                        <option value="500">500ms</option>
                        <option value="1000" selected>1s</option>
                        <option value="2000">2s</option>
                        <option value="5000">5s</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Max Concurrent Trades</label>
                    <input type="number" id="maxTrades" value="5" min="1" max="20" class="bg-gray-700 border border-gray-600 rounded-md px-3 py-2 w-full">
                </div>
            </div>
        </div>

        <!-- Active Trades -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-bold mb-4">Active Trades</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-700">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Token</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Network</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Entry Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Current Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Profit/Loss</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tradesTableBody" class="bg-gray-800 divide-y divide-gray-700">
                        <!-- Trades will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Token Queue -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-bold mb-4">Token Queue</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-700">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Token</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Network</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Score</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Age</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody id="queueTableBody" class="bg-gray-800 divide-y divide-gray-700">
                        <!-- Queue items will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-bold mb-4">Performance Over Time</h2>
            <canvas id="performanceChart" width="400" height="200"></canvas>
        </div>

        <!-- Network Status -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-xl font-bold mb-4">Network Status</h2>
            <div class="grid grid-cols-1 md:grid-cols-6 gap-4" id="networkStatus">
                <!-- Axiom status will be populated here -->
                <div class="bg-gray-700 p-4 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-semibold">Axiom</span>
                        <span id="axiom-status" class="text-yellow-400">● Checking...</span>
                    </div>
                    <div class="text-sm text-gray-400">
                        <div>Primary Data Source</div>
                        <div id="axiom-cache">Cache: 0</div>
                    </div>
                </div>
                <!-- Other network status will be populated here -->
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <h2 class="text-xl font-bold mb-4">Recent Activity</h2>
            <div class="space-y-3" id="recentActivity">
                <!-- Activity items will be populated here -->
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Global variables
        let performanceChart;
        let updateInterval;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            startAutoUpdate();
        });

        function initializeDashboard() {
            // Initialize performance chart
            const ctx = document.getElementById('performanceChart').getContext('2d');
            performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Profit/Loss',
                        data: [],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(75, 85, 99, 0.2)'
                            },
                            ticks: {
                                color: '#9CA3AF'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(75, 85, 99, 0.2)'
                            },
                            ticks: {
                                color: '#9CA3AF'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#9CA3AF'
                            }
                        }
                    }
                }
            });

            // Bind event listeners
            document.getElementById('refreshBtn').addEventListener('click', refreshData);
            document.getElementById('startBtn').addEventListener('click', startSniper);
            document.getElementById('stopBtn').addEventListener('click', stopSniper);
            document.getElementById('scanInterval').addEventListener('change', updateScanInterval);
            document.getElementById('maxTrades').addEventListener('change', updateMaxTrades);
        }

        function startAutoUpdate() {
            updateInterval = setInterval(updateDashboard, 5000); // Update every 5 seconds
            updateDashboard(); // Initial update
        }

        async function updateDashboard() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                updateStatusOverview(data);
                updateActiveTrades(data.activeTrades || []);
                updateTokenQueue(data.tokenQueue || []);
                updateAxiomStatus(data.axiom || {});
                updateNetworkStatus(data.networks || []);
                updateRecentActivity(data.recentActivity || []);
                
            } catch (error) {
                console.error('Error updating dashboard:', error);
                showToast('Error updating dashboard', 'error');
            }
        }

        function updateStatusOverview(data) {
            document.getElementById('totalProfit').textContent = `$${data.totalProfit || 0}`;
            document.getElementById('winRate').textContent = `${Math.round((data.winRate || 0) * 100)}%`;
            document.getElementById('activeTrades').textContent = data.activeTrades?.length || 0;
            document.getElementById('uptime').textContent = formatUptime(data.uptime || 0);
        }

        function updateActiveTrades(trades) {
            const tbody = document.getElementById('tradesTableBody');
            tbody.innerHTML = '';

            if (trades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-400">No active trades</td></tr>';
                return;
            }

            trades.forEach(trade => {
                const row = document.createElement('tr');
                const profitLoss = ((trade.currentPrice - trade.entryPrice) / trade.entryPrice) * 100;
                const profitClass = profitLoss >= 0 ? 'text-green-400' : 'text-red-400';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="text-sm font-medium">${trade.token.symbol}</div>
                            <div class="text-xs text-gray-400 ml-2">${trade.token.address.substring(0, 8)}...</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${trade.network}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">$${trade.entryPrice.toFixed(6)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">$${trade.currentPrice.toFixed(6)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${profitClass}">${profitLoss >= 0 ? '+' : ''}${profitLoss.toFixed(2)}%</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button class="text-red-400 hover:text-red-300" onclick="closeTrade('${trade.hash}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateTokenQueue(queue) {
            const tbody = document.getElementById('queueTableBody');
            tbody.innerHTML = '';

            if (queue.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-400">No tokens in queue</td></tr>';
                return;
            }

            queue.forEach(item => {
                const row = document.createElement('tr');
                const age = Math.floor((Date.now() - item.timestamp) / 1000);
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="text-sm font-medium">${item.token.symbol}</div>
                            <div class="text-xs text-gray-400 ml-2">${item.token.address.substring(0, 8)}...</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${item.network}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">${item.initialScore}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${formatAge(age)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                            Queued
                        </span>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateAxiomStatus(axiom) {
            const axiomStatus = document.getElementById('axiom-status');
            const axiomCache = document.getElementById('axiom-cache');
            
            if (axiom.initialized) {
                axiomStatus.className = 'text-green-400';
                axiomStatus.textContent = '● Connected';
                axiomCache.textContent = `Cache: ${axiom.cacheSize || 0}`;
            } else {
                axiomStatus.className = 'text-red-400';
                axiomStatus.textContent = '● Disconnected';
                axiomCache.textContent = 'Cache: N/A';
            }
        }

        function updateNetworkStatus(networks) {
            const container = document.getElementById('networkStatus');
            container.innerHTML = '';

            networks.forEach(network => {
                const statusClass = network.status === 'connected' ? 'text-green-400' : 'text-red-400';
                const bgClass = network.status === 'connected' ? 'bg-green-500 bg-opacity-20' : 'bg-red-500 bg-opacity-20';
                
                const div = document.createElement('div');
                div.className = 'text-center';
                div.innerHTML = `
                    <div class="p-3 rounded-full ${bgClass} inline-block mb-2">
                        <i class="fas fa-circle text-lg ${statusClass}"></i>
                    </div>
                    <p class="text-sm font-medium text-gray-400">${network.name}</p>
                    <p class="text-xs text-gray-500">${network.status}</p>
                `;
                container.appendChild(div);
            });
        }

        function updateRecentActivity(activities) {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '';

            activities.slice(0, 10).forEach(activity => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-3 p-3 bg-gray-700 rounded-lg';
                
                const iconClass = getActivityIcon(activity.type);
                const time = formatTime(activity.timestamp);
                
                div.innerHTML = `
                    <div class="flex-shrink-0">
                        <i class="${iconClass} text-lg"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-gray-300">${activity.message}</p>
                        <p class="text-xs text-gray-500">${time}</p>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function getActivityIcon(type) {
            const icons = {
                'trade': 'fas fa-exchange-alt text-green-400',
                'analysis': 'fas fa-search text-blue-400',
                'error': 'fas fa-exclamation-triangle text-red-400',
                'info': 'fas fa-info-circle text-gray-400'
            };
            return icons[type] || icons.info;
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);
            
            if (diff < 60) return `${diff}s ago`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return date.toLocaleDateString();
        }

        function formatAge(seconds) {
            if (seconds < 60) return `${seconds}s`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;
            return `${Math.floor(seconds / 3600)}h`;
        }

        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${hours}h ${minutes}m`;
        }

        async function startSniper() {
            try {
                const response = await fetch('/api/sniper/start', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showToast('Sniper started successfully', 'success');
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                } else {
                    showToast('Failed to start sniper', 'error');
                }
            } catch (error) {
                showToast('Error starting sniper', 'error');
            }
        }

        async function stopSniper() {
            try {
                const response = await fetch('/api/sniper/stop', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showToast('Sniper stopped successfully', 'success');
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                } else {
                    showToast('Failed to stop sniper', 'error');
                }
            } catch (error) {
                showToast('Error stopping sniper', 'error');
            }
        }

        async function closeTrade(tradeHash) {
            try {
                const response = await fetch(`/api/trades/${tradeHash}/close`, { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    showToast('Trade closed successfully', 'success');
                    updateDashboard();
                } else {
                    showToast('Failed to close trade', 'error');
                }
            } catch (error) {
                showToast('Error closing trade', 'error');
            }
        }

        async function updateScanInterval() {
            const interval = document.getElementById('scanInterval').value;
            try {
                const response = await fetch('/api/sniper/config', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ scanInterval: parseInt(interval) })
                });
                
                if (response.ok) {
                    showToast('Scan interval updated', 'success');
                } else {
                    showToast('Failed to update scan interval', 'error');
                }
            } catch (error) {
                showToast('Error updating scan interval', 'error');
            }
        }

        async function updateMaxTrades() {
            const maxTrades = document.getElementById('maxTrades').value;
            try {
                const response = await fetch('/api/sniper/config', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ maxConcurrentTrades: parseInt(maxTrades) })
                });
                
                if (response.ok) {
                    showToast('Max trades updated', 'success');
                } else {
                    showToast('Failed to update max trades', 'error');
                }
            } catch (error) {
                showToast('Error updating max trades', 'error');
            }
        }

        function refreshData() {
            updateDashboard();
            showToast('Data refreshed', 'info');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            const bgColor = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            }[type];
            
            toast.className = `${bgColor} text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            
            // Animate out and remove
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => container.removeChild(toast), 300);
            }, 3000);
        }
    </script>
</body>
</html>
